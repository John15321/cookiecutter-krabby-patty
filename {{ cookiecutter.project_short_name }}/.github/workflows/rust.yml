name: Rust

on: [push]

env:
  CARGO_TERM_COLOR: always

jobs:
  formatting:
    name: ğŸ‘”âœ’ï¸Formatting and Linting
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: ğŸ‘”Check Formatting
        run: cargo fmt -- --verbose --check --color auto
      - name: âœ’ï¸Check linting
        run: |
          rustup component add clippy
          set env RUSTFLAGS="-Dwarnings"
          cargo clippy --workspace -- -D warnings

  build:
    name: ğŸ”¨Build release
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: ğŸ”¨Build release
        run: cargo build --release

  test:
    name: ğŸ§ªRun tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: ğŸ§ªRun tests
        run: cargo test --verbose

  docs:
    name: ğŸ“„Build docs
    runs-on: ubuntu-latest
    needs: [formatting, build, test]
    steps:
      - uses: actions/checkout@v2
      - name: ğŸ“„Build docs
        run: cargo doc --verbose

  package:
    name: ğŸ“¦Check package generation
    runs-on: ubuntu-latest
    needs: [formatting, build, test]
    steps:
      - uses: actions/checkout@v2
      - name: ğŸ“¦Check package generation
        run: cargo package
